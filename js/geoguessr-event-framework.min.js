class GeoGuessrEventFramework{constructor(){this.STATE_DEFAULTS={current_game_id:null,is_challenge_link:!1,current_round:0,round_in_progress:!1,game_in_progress:!0},this.STATE=this.STATE_DEFAULTS,this.events=new EventTarget,this.loadState();let e=document.querySelector("#__next");if(!e)return;new MutationObserver(this.checkState.bind(this)).observe(e,{subtree:!0,childList:!0})}loadState(){this.STATE=this.STATE_DEFAULTS;let e=window.localStorage.getItem("GeoGuessrEventFramework_STATE");if(!e)return;let t=JSON.parse(e);e&&(t.current_round=0,t.round_in_progress=!1,t.game_in_progress=!0,Object.assign(this.STATE,t),this.saveState())}saveState(){window.localStorage.setItem("GeoGuessrEventFramework_STATE",JSON.stringify(this.STATE))}getCurrentRound(){const e=document.querySelector('div[class^="status_inner__"]>div[data-qa="round-number"]'),t=e?.children[1].textContent;return t?parseInt(t.split(/\//gi)[0].trim()):null}getGameMode(){if(location.pathname.startsWith("/game/"))return"game";if(location.pathname.startsWith("/challenge/"))return"challenge"}getGameId(){return window.location.href.substring(window.location.href.lastIndexOf("/")+1)}startRound(){this.getGameMode()&&(this.STATE.current_round=this.getCurrentRound(),this.STATE.round_in_progress=!0,this.STATE.game_in_progress=!0,this.STATE.current_game_id=this.getGameId(),this.STATE.is_challenge_link=this.getGameMode()=="challenge",this.saveState(),this.events.dispatchEvent(new CustomEvent("round_start",{detail:this.STATE})))}stopRound(){this.STATE.round_in_progress=!1,this.saveState()}checkState(){const e=document.querySelector(".game-layout"),t=document.querySelector('div[class^="result-layout_root"]'),r=document.querySelector('div[class^="result-layout_root"] div[class^="result-overlay_overlayContent__"]');e&&(this.STATE.current_round!==this.getCurrentRound()||this.STATE.current_game_id!==this.getGameId()?(this.STATE.round_in_progress&&this.stopRound(),this.startRound()):t&&this.STATE.round_in_progress?this.stopRound():r&&this.STATE.game_in_progress&&(this.STATE.game_in_progress=!1))}}window.GeoGuessrEventFramework=new GeoGuessrEventFramework;
